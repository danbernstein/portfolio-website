<!DOCTYPE html>
<html lang="en-us"><head>
  
    
      






<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Forecasting: Attributable Death | Data By Dan</title>
<meta name="title" content="Forecasting: Attributable Death | Data By Dan" />
<meta name="description" content="This is the fourth and final post in a series that seek to recreate the methods used in Future ozone-related acute excess mortality under climate and population change scenarios in China: A modeling study. All the posts build on my previous post on forecasting, by using data available from national and international research initatives to project future scenarios for complex systems including atmospheric chemistry, population dynamics, and mortality rate. This post focuses on combining the previous three projections to derive human health outcome metrics: attributable fraction and attributable daily death."> 


<link rel="canonical" href="https://danbernstein.netlify.app/post/2018-10-30/forecasting-attributable-death/" />


  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:description" content="" /> 
  <meta name="twitter:title" content="Forecasting: Attributable Death | Data By Dan" />
  <meta name="twitter:url" content="https://danbernstein.netlify.app/post/2018-10-30/forecasting-attributable-death/" />
  <meta name="twitter:site" content="@Softorage" /> 
  <meta name="twitter:creator" content="@Softorage" /> 
   



  
  <meta property="og:title" content="Forecasting: Attributable Death | Data By Dan" />
  <meta property="og:description" content="" /> 
  <meta property="og:site_name" content="Data By Dan" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://danbernstein.netlify.app/post/2018-10-30/forecasting-attributable-death/" />
  
   



<meta property="article:published_time" content="2018-10-30 00:00:00 &#43;0000 UTC" />


  
  
  <script type="application/ld+json">
      { 
          "@context": "http://schema.org", 
          "@type": "BlogPosting",
          "headline": "Forecasting: Attributable Death",
          
          "url": "https://danbernstein.netlify.app/",
          
          "datePublished": "2018-10-30T00:00:00Z",
          
          
          "dateModified": "2018-10-30T00:00:00Z",
          
          "description": ,
          
          
          "author": {
              "@type": "Person",
              "name": "Dan"
          },
          
          "publisher": {
            "@type": "Organization",
            "name": "Dan Bernstein",
            "logo": {
              "@type": "ImageObject",
              "url": ""
            }
          },
          
          "sameAs" : [
            
            
              "https://github.com/danbernstein",  
            
              "https://twitter.com/danbernstein18"
            ]
          
        }
      </script>
  


    
    <meta name="generator" content="Hugo 0.76.4" />
  
  
  
  
  
  <link rel="stylesheet" href="/assets/css/main.min.9a551348bb4a6a2c0bc4401302fe04a74b1507276ba1d0aca4b2308afb7f452e.css" integrity="sha256-mlUTSLtKaiwLxEATAv4Ep0sVBydrodCspLIwivt/RS4=" crossorigin="anonymous">
  
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  
  <link rel=apple-touch-icon sizes=180x180 href=https://danbernstein.netlify.app//assets/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://danbernstein.netlify.app//assets/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://danbernstein.netlify.app//assets/favicon/favicon-16x16.png><link rel=manifest href=https://danbernstein.netlify.app//assets/favicon/site.webmanifest><link rel=mask-icon href=https://danbernstein.netlify.app//assets/favicon/safari-pinned-tab.svg color=#7817c4><link rel=icon href=https://danbernstein.netlify.app//assets/favicon/favicon.ico type=image/x-icon><link rel="shortcut icon" href=https://danbernstein.netlify.app//assets/favicon/favicon.ico type=image/x-icon><meta name=apple-mobile-web-app-title content="Vibrant Shadows Theme"><meta name=application-name content="Vibrant Shadows Theme"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff">
  
  
  
  <meta name="theme-color" content="#fff6f8">
  
  <meta name="msapplication-navbutton-color" content="#fff6f8">
  
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  
</head>
<body><header>
  <nav class="navbar navbar-expand-lg navbar-light fixed-top flex-column">
    <div class="container-fluid">
      
      <a class="navbar-brand rounded px-3" href="https://danbernstein.netlify.app/"><span class="text-nav"><span class="brand">&nbsp;&nbsp;Data By Dan</span></span></a>
      
      
        <a class="navbar-toggler border-0 bg-nav p-2" role="button" href="#" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="text-clr2">&#9776;</span>
        </a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-md-auto">
             
            
              
                <li class="nav-item mx-1 my-2">
                  <a class="btn bg-nav text-clr1" href="/about-dan/">About Dan</a>
                </li>
              
            
          </ul>
          
            
          
        </div>
      
    </div>
    
  </nav>
</header>
<div id="content">
<div class="container-fluid bg-clr1 text-nav text-center pb-3 pt-4 position-relative shadow">
  <div style="height:3.5rem;"></div>
  <h1>Forecasting: Attributable Death</h1>
  <p class="description"></p>
</div>
<div class="container-fluid bg-nav p-4">  
  <div class="row">
 
    <div class="col-md-auto">
 
        
      
      <div class="py-1">
        <div class="d-inline mr-auto small text-muted post-meta"></span>
        
        
          
            
          
        
          
        
          
            
          
        
          
            
          
        By Dan &#183; 8 min read &#183; <span class=''>Last updated: October 30, 2018</div>
        
        
        
        <div class="d-inline ml-auto float-right">
          Share on:&nbsp;&nbsp;
          <span class="lead">
            
              <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdanbernstein.netlify.app%2fpost%2f2018-10-30%2fforecasting-attributable-death%2f&quote=Forecasting%3a%20Attributable%20Death" rel="noreferrer nofollow" target="_blank" title="Share on Facebook" aria-label="Share on Facebook"><span class="fab fa-facebook"></span></a>&nbsp;&nbsp;
            
            
              <a href="https://twitter.com/intent/tweet?source=https%3a%2f%2fdanbernstein.netlify.app%2fpost%2f2018-10-30%2fforecasting-attributable-death%2f&text=Forecasting%3a%20Attributable%20Death:%0Ahttps%3a%2f%2fdanbernstein.netlify.app%2fpost%2f2018-10-30%2fforecasting-attributable-death%2f" rel="noreferrer nofollow" target="_blank" title="Share on Twitter" aria-label="Share on Twitter"><span class="fab fa-twitter"></span></a>&nbsp;&nbsp;
            
            
              <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fdanbernstein.netlify.app%2fpost%2f2018-10-30%2fforecasting-attributable-death%2f&title=Forecasting%3a%20Attributable%20Death&summary=&source=Data%20By%20Dan" rel="noreferrer nofollow" target="_blank" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="fab fa-linkedin"></span></a>&nbsp;&nbsp;
            
            
              <a href="https://t.me/share/url?url=https%3a%2f%2fdanbernstein.netlify.app%2fpost%2f2018-10-30%2fforecasting-attributable-death%2f&text=Forecasting%3a%20Attributable%20Death" rel="noreferrer nofollow" target="_blank" title="Share on Telegram" aria-label="Share on Telegram"><span class="fab fa-telegram"></span></a>&nbsp;&nbsp;
            
            
              <a href="whatsapp://send?text=https%3a%2f%2fdanbernstein.netlify.app%2fpost%2f2018-10-30%2fforecasting-attributable-death%2f%0A%0AForecasting%3a%20Attributable%20Death" data-text="Forecasting: Attributable Death" data-href="https://danbernstein.netlify.app/post/2018-10-30/forecasting-attributable-death/" rel="noreferrer nofollow" target="_blank" title="Share on Whatsapp" aria-label="Share on Whatsapp"><span class="fab fa-whatsapp"></span></a>&nbsp;&nbsp;
            
            
              <a href="https://reddit.com/submit?url=https%3a%2f%2fdanbernstein.netlify.app%2fpost%2f2018-10-30%2fforecasting-attributable-death%2f&title=Forecasting%3a%20Attributable%20Death" rel="noreferrer nofollow" target="_blank" title="Share on Reddit" aria-label="Share on Reddit"><span class="fab fa-reddit"></span></a>&nbsp;&nbsp;
            
            
              <a href="mailto:?subject=Forecasting%3a%20Attributable%20Death&body=%0A%0Ahttps%3a%2f%2fdanbernstein.netlify.app%2fpost%2f2018-10-30%2fforecasting-attributable-death%2f" target="_blank" title="Share via email" aria-label="Share via email"><span class="fas fa-envelope"></span></a>
            
          </span>
        </div>
        
        
        
        
      </div>
      
      
      <div class="py-3">
      


<p><em>This is the fourth and final post in a series that seek to recreate the methods used in <a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.1002598#sec014">Future ozone-related acute excess mortality under climate and population change scenarios in China: A modeling study</a>. All the posts build on my previous post on <a href="https://danbernstein.netlify.app/post/learning-forecasting/">forecasting</a>, by using data available from national and international research initatives to project future scenarios for complex systems including <a href="https://danbernstein.netlify.app/post/climate-modeling/">atmospheric chemistry</a>, <a href="https://danbernstein.netlify.app/post/population-projections/">population dynamics</a>, and <a href="https://danbernstein.netlify.app/post/mortality-rate-projections/">mortality rate</a>. This post focuses on combining the previous three projections to derive human health outcome metrics: attributable fraction and attributable daily death.</em></p>
<p>This post does not actually forecast anything, but it does bring together three forecasts (ozone concentrations, population dynamics, and mortality rates) to demonstrate the methods used to forecast future attributable deaths. This task is more about wrangling the outputs of the other forecasts into a format that is efficient for calculating the final value.</p>
<p>IMPORTANT NOTE: This post uses the CRF values for the Chinese population from the <a href="https://ehp.niehs.nih.gov/doi/abs/10.1289/EHP1849?url_ver=Z39.88-2003&amp;rfr_id=ori:rid:crossref.org&amp;rfr_dat=cr_pub%3dpubmed">2017 nationwide study</a>. These values are not appropriate for the subset of the US population that I will use here. Additionally, the mortality rate used is purely hypothetical and is not based on any epidemiological studies.</p>
<div id="methods-calculating-attributable-annual-death" class="section level2">
<h2>Methods: Calculating Attributable Annual Death</h2>
<div id="overview-of-analysis" class="section level3">
<h3><em>Overview of Analysis</em></h3>
<p>The workflow for this analysis involves recreating the methods used in the PLOS Medicine article under the heading “health impact assessment”.</p>
<p>To break down this section into discrete steps:</p>
<ul>
<li>load the appropriate packages</li>
<li>Wrangle the outputs of the other forecasts into datasets appropriate for inputting into the calculations</li>
<li>Calculate attributable fraction (AF) and attributable daily deaths (ADD) for the general population and under group-specific conditions</li>
</ul>
</div>
</div>
<div id="analysis" class="section level2">
<h2>Analysis</h2>
<p>The historical and future ozone values represent monitoring stations across the state of California. The population projections are solely for the city of San Francisco, CA. To fully reproduce the methods in the PLOS Medicine article, I would need to subset the raster values that fall within a given city’s geographic boundaries.</p>
<pre class="r"><code>library(dplyr)
library(tidyverse)
library(tsibble)

## load bias-corrected, spatially disaggregated future ozone values, 2051-2055
ts_futuretro3 &lt;- 
  read_csv(&quot;./markdown_data/forecasting_tro3/cali_stations_ts/future_tro3.csv&quot;) %&gt;% 
  column_to_rownames(&quot;X1&quot;)

## load historical ozone observations, 2011
ts_histtro3 &lt;- 
  read_csv(&quot;./markdown_data/forecasting_tro3/cali_stations_ts/hist_tro3.csv&quot;) %&gt;% 
  column_to_rownames(&quot;X1&quot;)

## population projections, for each decade between 2010 and 2100

pop_proj &lt;- read.csv(&quot;./markdown_data/forecasting_tro3/pop_projections/sf_2010_2100.csv&quot;)</code></pre>
<p>The concentration-response functions are taken from the Chinese epidemiological study:</p>
<pre class="r"><code>## CRF from paper conducted in major chinese cities

crf_groups &lt;- c(&quot;all_nonaccidental&quot;, &quot;cardiovascular&quot;, &quot;respiratory&quot;, &quot;5-64&quot;, &quot;65-74&quot;, 
                &quot;&gt;=75&quot;, &quot;Warm (May-Oct)&quot;, &quot;Cold (Nov-Apr&quot;)
crf &lt;- c(0.24, 0.27, 0.18, 0.13, 0.19, 0.42, 0.20, 0.43)
crf_95l &lt;- c(0.13, 0.10, -0.11, -0.23, 0.03, 0.21, 0.08, 0.21)
crf_95u &lt;- c(0.35, 0.44, 0.47, 0.48, 0.34, 0.64, 0.31, 0.65)
crf_df &lt;- data_frame(crf_groups, crf, crf_95l, crf_95u)</code></pre>
<p>I have created a purely hypothetical mortality rate to use in the calculation. This value is not based on any epidemiological studies and is purely to stand in for the mortality rate variable in subsequent calculations:</p>
<pre class="r"><code># simulated mortality rate (10 deaths per 10 million people)
mort_rate &lt;- 10 / 10000000</code></pre>
<p>A simple function will take in ozone concentration values (“x”) and multiple it by the concentration response factor to obtain the attributable fraction at each station at each time point.</p>
<pre class="r"><code>calcAF &lt;- function(df, crf_val){
  AF &lt;-
  df %&gt;% 
  mutate_if(is.numeric, function(x){1 - exp(-x * crf_val[1])}) # AF = 1 - exp(tro3 * crf)
  
  return(AF)
}

# data wrangling
hist_data &lt;- 
  ts_histtro3 %&gt;% 
  mutate(val = rownames(.)) %&gt;% 
  gather(dt, obs, -val) %&gt;% 
  mutate(obs = replace_na(obs, 0)) %&gt;% 
  spread(key = val, value = obs) %&gt;% 
  mutate(dt = lubridate::as_date(dt)) %&gt;% 
  as_tsibble()

# calculate attributable fraction (AF)
hist.AF.sf &lt;- calcAF(hist_data, crf_df$crf) </code></pre>
<p>The data frame of AF values is then merged with population projections and the simulated mortality rate. In the last line, the attributable daily deaths are calculated based on the population projections (“x”), mortality rates, and attributable fractions.</p>
<pre class="r"><code># data wrangling and then calculate attributable daily deaths (ADD)
hist.ADD.sf &lt;-
  hist.AF.sf %&gt;% 
  gather(station, af) %&gt;% 
  mutate(start_decade = plyr::round_any(lubridate::year(dt), 10, floor)) %&gt;% 
  left_join(., pop_proj, by = c(&#39;start_decade&#39; = &#39;start_year&#39;)) %&gt;% 
  # bind the simulated mortality rate
  mutate(mortrate = mort_rate) %&gt;% 
  # calculate ADD
  mutate_if(grepl(&quot;ssp&quot;, names(.)), function(x){x * .$mortrate * .$af}) # Yb * POP * AF</code></pre>
<p>The attributable daily deaths are then aggregated annually to produce the estimated annual deaths associated with the ozone contentration changes.</p>
<pre class="r"><code># aggregate the annual data
# note that this code is only using a single measure per month, so the totals are 
# only for 12 days of the year, simply to demonstrate the methods
hist.annualdeaths.sf &lt;- 
  hist.ADD.sf %&gt;% 
  as.data.frame() %&gt;% 
  mutate(year = lubridate::year(dt)) %&gt;% 
  dplyr::select(-mortrate) %&gt;% 
  group_by(station, year) %&gt;% 
  # sum grouped values in the same year
  summarise_at(vars(starts_with(&quot;ssp&quot;)), sum) %&gt;% 
  ungroup()

hist.annualdeaths.sf</code></pre>
<p>The output is a data frame where each row is a station for a given year and the sum of all ADD within the year under the five shared socioeconomic pathways.</p>
<p>We now repeat the process for the future data.</p>
<pre class="r"><code>## future

future_data &lt;- 
  ts_futuretro3 %&gt;% 
  mutate(val = rownames(.)) %&gt;% 
  gather(dt, obs, -val) %&gt;% 
  mutate(obs = replace_na(obs, 0)) %&gt;% 
  spread(key = val, value = obs) %&gt;% 
  mutate(dt = lubridate::as_date(dt)) %&gt;% 
  as_tsibble()

# calculate attributable fraction (AF)
future.AF.sf &lt;- calcAF(future_data, crf_df$crf) 

# data wrangling and then calculate attributable daily deaths (ADD)
future.ADD.sf &lt;-
  future.AF.sf %&gt;% 
  gather(station, af) %&gt;% 
  mutate(start_decade = plyr::round_any(lubridate::year(dt), 10, floor)) %&gt;% 
  left_join(., pop_proj, by = c(&#39;start_decade&#39; = &#39;start_year&#39;)) %&gt;% 
  # bind the simulated mortality rate
  mutate(mortrate = mort_rate) %&gt;% 
  # calculate ADD
  mutate_if(grepl(&quot;ssp&quot;, names(.)), function(x){x * .$mortrate * .$af}) # Yb * POP * AF

# aggregate the annual data
# note that this code is only using a single measure per month, so the totals are 
# only for 12 days of the year, simply to demonstrate the methods
future.annualdeaths.sf &lt;- 
  future.ADD.sf %&gt;% 
  as.data.frame() %&gt;% 
  mutate(year = lubridate::year(dt)) %&gt;% 
  dplyr::select(-mortrate) %&gt;% 
  group_by(station, year) %&gt;% 
  # sum grouped values in the same year
  summarise_at(vars(starts_with(&quot;ssp&quot;)), sum) %&gt;% 
  ungroup()</code></pre>
<p>With the annual estmates for the historical and future period, we can now calculate the future excess by subtracting the historical annual deaths from the future annual deaths. To simplify this calculation, I will subset the future values to only include the year 2051.</p>
<pre class="r"><code># let&#39;s compare 2011 to 2051
future.excess.annualdeaths.sf &lt;- 
  future.annualdeaths.sf %&gt;% 
  filter(year == 2051) %&gt;% 
  left_join(hist.annualdeaths.sf, by = &quot;station&quot;) %&gt;% 
  dplyr::select(-year.x, -year.y) %&gt;% 
  dplyr::mutate(ssp1.excess = ssp1.x - ssp1.y,
                   ssp2.excess = ssp2.x - ssp2.y,
                   ssp3.excess = ssp3.x - ssp3.y,
                   ssp4.excess = ssp4.x - ssp4.y,
                   ssp5.excess = ssp5.x - ssp5.y) %&gt;% 
  dplyr::select_at(vars(contains(&quot;excess&quot;)))

future.excess.annualdeaths.sf</code></pre>
<p>There are increases at all stations between 2011 and 2051. The PLOS Medicine article further explored how the various forecasts in ozone, population, and mortality contributed to the excess mortality. I will not attempt to recreate these methods because I have used a hypothetical mortality rate in this calculation and I have not conducted the appropriate geospatial subsetting to obtain the local ozone concentrations within the city of interest. This article has been an excellent model for practicing forecasting and deepening my knowledge of environmental health.</p>
</div>

      </div>
      
      
      
      <div class="pt-4 mt-2 border-top">
        <div class="d-inline mr-auto small text-muted post-meta mb-1">
        
        
          
        
          
        
          
        
          
        </div>
        
        
        
      
      
      
      
      
        <div class="mt-3">
        <span class="">Tags:</span>&nbsp;&nbsp;&nbsp;<a href="/tags/r"><span class="badge badge-pill bg-clr2 text-nav mr-2 py-2">R</span></a><a href="/tags/analysis"><span class="badge badge-pill bg-clr2 text-nav mr-2 py-2">ANALYSIS</span></a><a href="/tags/forecasting"><span class="badge badge-pill bg-clr2 text-nav mr-2 py-2">FORECASTING</span></a></div>
      
      
      </div>
      
    </div>
  </div>
  
  
  
</div>

    </div><footer class="text-center p-2 text-muted footer">
  
    
    <div class="py-2 lead">
      
        
          <a class="ml-2" href="https://github.com/danbernstein"><span class="fab fa-github" aria-label="Join us on Github"></span></a>
        
      
        
          <a class="ml-2" href="https://twitter.com/danbernstein18"><span class="fab fa-twitter" aria-label="Join us on Twitter"></span></a>
        
      
    </div>
    
  

  

  <div class="py-2 copyright">
    <small>Copyright &#169; 2020 Dan Bernstein <b>&#183;</b> Content license: CC-BY-SA-3.0 <b>&#183;</b> Powered by <a class="font-weight-bold text-reset text-decoration-none" href="https://gohugo.io">Hugo</a> <b>&#183;</b> Theme <a class="font-weight-bold text-reset text-decoration-none" href="">Shadows</a> by <span class="softorage"><a class="font-weight-bold text-reset" href="https://softorage.com">Softorage</a></span></small>
  </div>
</footer>

    
    
    
    <script src="/assets/js/main.min.6ff0d57b7558f0225c80bade926a349330bc25d85e7ceff50d911f1156023c3e.js" integrity="sha256-b/DVe3VY8CJcgLrekmo0kzC8JdhefO/1DZEfEVYCPD4=" crossorigin="anonymous"></script>
    <script src="/assets/js/custom.min.c8274a0cac0477f854e63f09626cc63858bb2bc9db8faecbb2834846952c7fd6.js" integrity="sha256-yCdKDKwEd/hU5j8JYmzGOFi7K8nbj67LsoNIRpUsf9Y=" crossorigin="anonymous"></script>
    
    <link href="https://fonts.googleapis.com/css?family=Roboto|Lato&display=swap" rel="stylesheet">
    
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
  </body>
</html>
